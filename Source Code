import tkinter as tk
from tkinter import messagebox
import json

FILE_NAME = "tasks.json"


# ---------- File Handling ---------- #

def load_tasks():
    try:
        with open(FILE_NAME, "r") as file:
            return json.load(file)
    except FileNotFoundError:
        return []


def save_tasks():
    with open(FILE_NAME, "w") as file:
        json.dump(tasks, file, indent=4)


# ---------- Task Functions ---------- #

def add_task():
    title = title_entry.get()
    priority = priority_entry.get()
    due_date = due_entry.get()

    if not title:
        messagebox.showwarning("Warning", "Task title is required!")
        return

    task = {
        "title": title,
        "priority": priority,
        "due_date": due_date,
        "completed": False
    }

    tasks.append(task)
    save_tasks()
    refresh_list()
    clear_fields()


def delete_task():
    try:
        index = task_listbox.curselection()[0]
        tasks.pop(index)
        save_tasks()
        refresh_list()
    except IndexError:
        messagebox.showwarning("Warning", "Select a task to delete!")


def mark_completed():
    try:
        index = task_listbox.curselection()[0]
        tasks[index]["completed"] = True
        save_tasks()
        refresh_list()
    except IndexError:
        messagebox.showwarning("Warning", "Select a task to mark!")


def edit_task():
    try:
        index = task_listbox.curselection()[0]
        tasks[index]["title"] = title_entry.get()
        tasks[index]["priority"] = priority_entry.get()
        tasks[index]["due_date"] = due_entry.get()
        save_tasks()
        refresh_list()
        clear_fields()
    except IndexError:
        messagebox.showwarning("Warning", "Select a task to edit!")


def refresh_list():
    task_listbox.delete(0, tk.END)
    for task in tasks:
        status = "✔ Done" if task["completed"] else "❌ Pending"
        task_listbox.insert(
            tk.END,
            f"{task['title']} | {task['priority']} | {task['due_date']} | {status}"
        )


def clear_fields():
    title_entry.delete(0, tk.END)
    priority_entry.delete(0, tk.END)
    due_entry.delete(0, tk.END)


# ---------- GUI Setup ---------- #

root = tk.Tk()
root.title("To-Do List App")
root.geometry("500x450")

tasks = load_tasks()

tk.Label(root, text="Task Title").pack()
title_entry = tk.Entry(root, width=40)
title_entry.pack()

tk.Label(root, text="Priority (Low / Medium / High)").pack()
priority_entry = tk.Entry(root, width=40)
priority_entry.pack()

tk.Label(root, text="Due Date (YYYY-MM-DD)").pack()
due_entry = tk.Entry(root, width=40)
due_entry.pack()

tk.Button(root, text="Add Task", width=20, command=add_task).pack(pady=5)
tk.Button(root, text="Edit Task", width=20, command=edit_task).pack(pady=5)
tk.Button(root, text="Delete Task", width=20, command=delete_task).pack(pady=5)
tk.Button(root, text="Mark Completed", width=20, command=mark_completed).pack(pady=5)

task_listbox = tk.Listbox(root, width=70)
task_listbox.pack(pady=10)

refresh_list()

root.mainloop()
